---
import StarlightHead from "@astrojs/starlight/components/Head.astro";
import VtbotStarlight from "astro-vtbot/components/starlight/Base.astro";
import { ANALYTICS } from "@data/constants";

const GTM_ID = ANALYTICS.GTM_ID;
---

<VtbotStarlight {...Astro.props} viewTransitionsFallback="animate">
  <StarlightHead {...Astro.props}>
    {/* Google Tag Manager Head Script for Starlight */}
    <script is:inline define:vars={{ GTM_ID }}>
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer',GTM_ID);
    </script>
    <slot />
  </StarlightHead>
  <script>
    import "@scripts/lenisSmoothScroll.js";
  </script>
</VtbotStarlight>

<style is:global>
  /* Slow down Chrome's default animation */
  ::view-transition-group(root) {
    animation-duration: 250ms;
  }

  /* Do not slide over the sidebars */
  ::view-transition-group(*) {
    overflow: hidden;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const siteSearch = document.querySelector(
      "site-search"
    ) as HTMLElement | null;
    if (siteSearch) {
      siteSearch.setAttribute("data-lenis-prevent", "");
    }
  });
</script>
